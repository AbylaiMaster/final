<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task List</title>
    <style>
        .overdue { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h2>Task List</h2>
    
    <h3>Add New Task</h3>
    <input type="text" id="title" placeholder="Task Title" required>
    <input type="text" id="description" placeholder="Description">
    <input type="datetime-local" id="due_date" required>
    <select id="priority">
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
    </select>
    <input type="text" id="category" placeholder="Category">
    <input type="email" id="email" placeholder="User Email" required>
    <button onclick="addTask()">Add Task</button>
    
    <label for="filter">Filter by Time:</label>
    <select id="filter">
        <option value="all">All Tasks</option>
        <option value="day">For the Day</option>
        <option value="week">For the Week</option>
        <option value="month">For the Month</option>
    </select>
    
    <label for="priorityFilter">Filter by Priority:</label>
    <select id="priorityFilter">
        <option value="all">All</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
    </select>

    <div id="taskContainer"></div>

    <script>
        const API_URL = "https://final-zrye.onrender.com";

        async function fetchTasks() {
            const filter = document.getElementById("filter").value;
            const priorityFilter = document.getElementById("priorityFilter").value;
            let url = API_URL;
            if (filter !== "all") {
                url = `${API_URL}/filter?period=${filter}`;
            }

            const response = await fetch(url);
            let tasks = await response.json();
            
            if (priorityFilter !== "all") {
                tasks = tasks.filter(task => task.priority === priorityFilter);
            }
            displayTasks(tasks);
        }

        function displayTasks(tasks) {
            const container = document.getElementById("taskContainer");
            container.innerHTML = "";
            tasks.forEach(task => {
                const now = new Date();
                const dueDate = new Date(task.due_date);
                const isOverdue = dueDate < now;
                
                const taskElement = document.createElement("div");
                taskElement.innerHTML = `
                    <h3>${task.title}</h3>
                    <p>Description: ${task.description}</p>
                    <p>Category: ${task.category}</p>
                    <p>Priority: ${task.priority}</p>
                    <p class="${isOverdue ? 'overdue' : ''}">Deadline: ${dueDate.toLocaleString()}</p>
                    <button onclick="editTask('${task._id}')">Edit</button>
                    <button onclick="deleteTask('${task._id}')">Delete</button>
                `;
                container.appendChild(taskElement);
            });
        }

        async function addTask() {
            const task = {
                title: document.getElementById("title").value,
                description: document.getElementById("description").value,
                due_date: document.getElementById("due_date").value,
                priority: document.getElementById("priority").value,
                category: document.getElementById("category").value,
                email: document.getElementById("email").value,
                is_complete: false
            };
            
            const response = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(task)
            });
            if (response.ok) fetchTasks();
        }

async function editTask(taskId) {
    const newTitle = prompt("Enter new title:");
    const newDescription = prompt("Enter new description:");
    const newDueDate = prompt("Enter new due date (YYYY-MM-DDTHH:MM):");
    const newPriority = prompt("Enter new priority (low, medium, high):");
    const newCategory = prompt("Enter new category:");
    
    const updatedTask = {};
    if (newTitle) updatedTask.title = newTitle;
    if (newDescription) updatedTask.description = newDescription;
    if (newDueDate) updatedTask.due_date = newDueDate;
    if (newPriority) updatedTask.priority = newPriority;
    if (newCategory) updatedTask.category = newCategory;
    
    await fetch(`${API_URL}/${taskId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(updatedTask)
    });
    fetchTasks();
}

async function deleteTask(taskId) {
    await fetch(`${API_URL}/${taskId}`, { method: "DELETE" });
    fetchTasks();
}

document.getElementById("filter").addEventListener("change", fetchTasks);
document.getElementById("priorityFilter").addEventListener("change", fetchTasks);
fetchTasks();
</script>
</body>
</html>